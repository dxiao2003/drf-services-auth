# coding=utf-8

from django.test import TestCase

import os, base64
from rest_framework_services_auth.settings import auth_settings
from rest_framework_services_auth.utils import jwt_encode_uid, jwt_decode_token


DEFAULT_TARGET = {
    'SECRET_KEY': 'n~\t\xff\x13\xabwy\x08q4\xfa\x9ahM\x0b\x89\x17\x94@\x8b@\xd5\x04`\x7f\xdc.\xcb\xa2g\x0f\xd3\x91\xe1\xd8p\xcf6\xcf3d\x15\xad\x05~b\x03\xf1\xe3\xb6Bf\xf0\xe6T\xa0\x12\xc3\xef\xd8\x04s\x9a\x10\xb1\x81\x108\xb1\xe5\x8bk)U5\xce\xf1\xde\xc9\x16{\xced\x18$\x0fG\xfa\x92.\xd9\xf3i`\x1ay\x14W\xdf0/\xed\x95\xa6\xa4\x8b\xc0\xce\x9d\xeb\xba\xe2[\xcdt\xbc\xde\xb2}\xbd\xf2_\xe0\xdf\x85\x1b\xb3\xc7$5w\xe2AB\xd3n4c\x82\x1c\x04Y0\xcf\xea\x8c\x9b\xd1v5\x15\xb3\x12\xb1\xa1+\xffC}n\x8b/\xa9\x12\x1eTi\x96\x8cB?\xfc\x12\x98\xf5\xfa\x8c;\x08\xf1sXN0\x89ve\r-a\xca(\xe8\xfb\xe6\x03\x00;"\xb5Cxhs\x0bn\xcf\t\x08\x05\xc3\x8a\x81\xc9\x0f\x86-\x96>\xd7\x07\xa2\xcd8h\xa8\xbd\xec\x8d\xc53\x9f:\xf73$\xe7\xf6\x02\xbefl\xfeK@\x95\x8c\x18\xa2N\x17\xfdA\xd9g',  # assume a sym key for test
    'ALGORITHM': auth_settings.JWT_ALGORITHM,
    'AUDIENCE': auth_settings.JWT_AUDIENCE,
    'ISSUER': auth_settings.JWT_ISSUER,
    'KEY_ID': 'key'
}

class UtilsTestCase(TestCase):
    def test_base64_decode_symmetric_key(self):
        jwt_token = jwt_encode_uid("1234", DEFAULT_TARGET)
        payload = jwt_decode_token(jwt_token)
        self.assertEqual(payload["uid"], "1234")
